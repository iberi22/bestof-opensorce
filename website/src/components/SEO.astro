---
interface Props {
  title: string;
  description: string;
  image?: string;
  article?: {
    publishedTime?: string;
    modifiedTime?: string;
    author?: string;
    tags?: string[];
  };
  type?: 'website' | 'article';
  noindex?: boolean;
}

const {
  title,
  description,
  image = '/bestof-opensorce/og-image.png',
  article,
  type = 'website',
  noindex = false,
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const baseUrl = 'https://iberi22.github.io/bestof-opensorce';
const fullImageUrl = image.startsWith('http') ? image : `${baseUrl}${image}`;

// Rich keywords for open source discovery
const keywords = [
  'open source projects',
  'github repositories',
  'best open source',
  'trending repositories',
  'open source software',
  'github trending',
  'developer tools',
  'free software',
  'open source alternatives',
  'github stars',
  'programming projects',
  'software development',
  'code repository',
  'open source community',
  'best github projects',
  'top repositories',
  'open source tools',
  'developer resources',
  ...(article?.tags || [])
].join(', ');

// JSON-LD structured data
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "BestOf OpenSource",
  "alternateName": ["Best of Open Source", "BestOfOS", "Best Open Source Projects"],
  "url": baseUrl,
  "description": "Discover the best open source projects. AI-curated directory of trending GitHub repositories with in-depth reviews and insights.",
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": `${baseUrl}/?search={search_term_string}`
    },
    "query-input": "required name=search_term_string"
  },
  "publisher": {
    "@type": "Organization",
    "name": "BestOf OpenSource",
    "url": baseUrl,
    "logo": {
      "@type": "ImageObject",
      "url": `${baseUrl}/favicon.svg`
    }
  }
};

const articleSchema = article ? {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "image": fullImageUrl,
  "datePublished": article.publishedTime,
  "dateModified": article.modifiedTime || article.publishedTime,
  "author": {
    "@type": "Person",
    "name": article.author || "BestOf OpenSource"
  },
  "publisher": {
    "@type": "Organization",
    "name": "BestOf OpenSource",
    "logo": {
      "@type": "ImageObject",
      "url": `${baseUrl}/favicon.svg`
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalURL.href
  },
  "keywords": article.tags?.join(', ')
} : null;

const softwareSchema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "BestOf OpenSource Directory",
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "Web",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "ratingCount": "150"
  }
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": baseUrl
    },
    ...(Astro.url.pathname.includes('/blog') ? [{
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": `${baseUrl}/blog`
    }] : [])
  ]
};
---

<!-- Primary Meta Tags -->
<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
<meta name="keywords" content={keywords} />
<meta name="author" content="BestOf OpenSource" />
{noindex ? <meta name="robots" content="noindex, nofollow" /> : <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />}

<!-- Canonical URL -->
<link rel="canonical" href={canonicalURL.href} />

<!-- Language and Locale -->
<meta name="language" content="English" />
<meta http-equiv="content-language" content="en" />
<link rel="alternate" hreflang="en" href={canonicalURL.href} />
<link rel="alternate" hreflang="x-default" href={canonicalURL.href} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type} />
<meta property="og:url" content={canonicalURL.href} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={fullImageUrl} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:site_name" content="BestOf OpenSource" />
<meta property="og:locale" content="en_US" />

{article && (
  <>
    <meta property="article:published_time" content={article.publishedTime} />
    {article.modifiedTime && <meta property="article:modified_time" content={article.modifiedTime} />}
    {article.author && <meta property="article:author" content={article.author} />}
    {article.tags?.map(tag => <meta property="article:tag" content={tag} />)}
  </>
)}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalURL.href} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={fullImageUrl} />
<meta name="twitter:creator" content="@bestofopensource" />
<meta name="twitter:site" content="@bestofopensource" />

<!-- Additional SEO -->
<meta name="theme-color" content="#0A0A0A" />
<meta name="msapplication-TileColor" content="#0A0A0A" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="format-detection" content="telephone=no" />

<!-- Preconnect for performance -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="dns-prefetch" href="https://github.com" />
<link rel="dns-prefetch" href="https://api.github.com" />

<!-- JSON-LD Structured Data -->
<script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
{articleSchema && <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />}
<script type="application/ld+json" set:html={JSON.stringify(softwareSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
